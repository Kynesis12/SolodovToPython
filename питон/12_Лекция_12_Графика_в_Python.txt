Лекция 12
Графика в Python

Цель лекции. Ознакомиться с правилами работы с графикой в Python. Научиться загружать готовые картинки, рисовать комбинированные фигуры, менять цвет, шрифт.

Python позволяет:
загрузить в приложение готовые картинки и фотографии,
разработать программы, которые выводят графику на поверхность объекта.
В Python можно загружать файлы – рисунки, созданные в других программах, например Paint, Corel Draw и др.

12.1. Рисованные изображения
Рисованные изображения отображаются на форме при выполнении программы с помощью различных инструментов. 
Изображение при этом представляет собой комбинацию простейших фигур – графических примитивов (точка, линия, круг или прямоугольник). 
Каждая точка на форме имеет координаты X и Y. Текущая позиция при рисовании определяется горизонтальной (X) и вертикальной (Y) координатами, заданными в пикселях. Координата Х возрастает при перемещении указателя слева на право, а координата Y – при перемещении его сверху вниз.

12.2 Библиотеки для работы с графикой в Python
В Python для работы с графикой используются различные библиотеки:

- **matplotlib** - для создания графиков и диаграмм
- **PIL (Pillow)** - для работы с изображениями
- **tkinter** - для простой графики в GUI приложениях
- **pygame** - для игровой графики
- **PIL + tkinter** - для отображения изображений в GUI

12.3 Работа с matplotlib
matplotlib - основная библиотека для создания графиков в Python.

import matplotlib.pyplot as plt
import numpy as np

# Создание простого графика
x = np.linspace(0, 2*np.pi, 100)
y = np.sin(x)

plt.figure(figsize=(8, 6))
plt.plot(x, y, 'b-', linewidth=2, label='sin(x)')
plt.xlabel('x')
plt.ylabel('y')
plt.title('График функции sin(x)')
plt.grid(True)
plt.legend()
plt.show()

12.4 Рисование примитивов с помощью matplotlib
import matplotlib.pyplot as plt
import matplotlib.patches as patches
from matplotlib.patches import Circle, Rectangle, Polygon

# Создание фигуры и осей
fig, ax = plt.subplots(figsize=(10, 8))

# Рисование линий
ax.plot([0, 1, 2, 3], [0, 1, 0, 1], 'r-', linewidth=2, label='Линия')

# Рисование прямоугольника
rect = Rectangle((0.5, 0.5), 1, 0.5, linewidth=2, edgecolor='blue', facecolor='lightblue')
ax.add_patch(rect)

# Рисование круга
circle = Circle((2, 2), 0.5, linewidth=2, edgecolor='green', facecolor='lightgreen')
ax.add_patch(circle)

# Рисование многоугольника
polygon = Polygon([(3, 0), (3.5, 1), (3, 2), (2.5, 1)], linewidth=2, edgecolor='purple', facecolor='lightpink')
ax.add_patch(polygon)

# Настройка осей
ax.set_xlim(0, 4)
ax.set_ylim(0, 3)
ax.set_aspect('equal')
ax.grid(True, alpha=0.3)
ax.legend()
ax.set_title('Графические примитивы')

plt.show()

12.5 Работа с текстом и шрифтами
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm

# Создание фигуры
fig, ax = plt.subplots(figsize=(10, 6))

# Различные стили текста
ax.text(0.1, 0.8, 'Обычный текст', fontsize=12, transform=ax.transAxes)
ax.text(0.1, 0.7, 'Жирный текст', fontsize=14, fontweight='bold', transform=ax.transAxes)
ax.text(0.1, 0.6, 'Курсивный текст', fontsize=12, style='italic', transform=ax.transAxes)
ax.text(0.1, 0.5, 'Цветной текст', fontsize=12, color='red', transform=ax.transAxes)

# Текст с рамкой
ax.text(0.1, 0.4, 'Текст в рамке', fontsize=12, 
        bbox=dict(boxstyle="round,pad=0.3", facecolor="yellow", alpha=0.7),
        transform=ax.transAxes)

# Математические формулы
ax.text(0.1, 0.3, r'$\alpha + \beta = \gamma$', fontsize=16, transform=ax.transAxes)
ax.text(0.1, 0.2, r'$y = \sin(x)$', fontsize=16, transform=ax.transAxes)

ax.set_xlim(0, 1)
ax.set_ylim(0, 1)
ax.set_title('Работа с текстом и шрифтами')
ax.axis('off')

plt.show()

12.6 Создание диаграмм и графиков функций
import matplotlib.pyplot as plt
import numpy as np

def create_function_plot():
    # Создание данных
    x = np.linspace(0, 4*np.pi, 1000)
    y1 = np.sin(x)
    y2 = np.cos(x)
    y3 = np.sin(x) * np.cos(x)
    
    # Создание фигуры с подграфиками
    fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(10, 12))
    
    # График sin(x)
    ax1.plot(x, y1, 'b-', linewidth=2, label='sin(x)')
    ax1.set_title('График функции sin(x)')
    ax1.set_xlabel('x')
    ax1.set_ylabel('y')
    ax1.grid(True, alpha=0.3)
    ax1.legend()
    
    # График cos(x)
    ax2.plot(x, y2, 'r-', linewidth=2, label='cos(x)')
    ax2.set_title('График функции cos(x)')
    ax2.set_xlabel('x')
    ax2.set_ylabel('y')
    ax2.grid(True, alpha=0.3)
    ax2.legend()
    
    # График sin(x) * cos(x)
    ax3.plot(x, y3, 'g-', linewidth=2, label='sin(x) * cos(x)')
    ax3.set_title('График функции sin(x) * cos(x)')
    ax3.set_xlabel('x')
    ax3.set_ylabel('y')
    ax3.grid(True, alpha=0.3)
    ax3.legend()
    
    plt.tight_layout()
    plt.show()

# Запуск функции
create_function_plot()

12.7 Работа с изображениями (PIL/Pillow)
from PIL import Image, ImageDraw, ImageFont
import numpy as np

# Создание нового изображения
width, height = 800, 600
image = Image.new('RGB', (width, height), 'white')
draw = ImageDraw.Draw(image)

# Рисование примитивов
# Линия
draw.line([(100, 100), (300, 200)], fill='red', width=3)

# Прямоугольник
draw.rectangle([(100, 250), (300, 350)], outline='blue', width=2)

# Залитый прямоугольник
draw.rectangle([(350, 250), (550, 350)], fill='lightblue', outline='blue', width=2)

# Эллипс
draw.ellipse([(100, 400), (300, 500)], outline='green', width=2)

# Залитый эллипс
draw.ellipse([(350, 400), (550, 500)], fill='lightgreen', outline='green', width=2)

# Многоугольник
points = [(600, 100), (700, 150), (650, 200), (550, 200), (500, 150)]
draw.polygon(points, outline='purple', fill='lightpink', width=2)

# Текст
try:
    # Попытка использовать системный шрифт
    font = ImageFont.truetype("arial.ttf", 24)
except:
    # Использование шрифта по умолчанию
    font = ImageFont.load_default()

draw.text((100, 50), "Графические примитивы в Python", fill='black', font=font)
draw.text((100, 300), "Прямоугольник", fill='black', font=font)
draw.text((350, 300), "Залитый прямоугольник", fill='black', font=font)
draw.text((100, 450), "Эллипс", fill='black', font=font)
draw.text((350, 450), "Залитый эллипс", fill='black', font=font)
draw.text((500, 250), "Многоугольник", fill='black', font=font)

# Сохранение изображения
image.save('graphics_primitives.png')
print("Изображение сохранено как 'graphics_primitives.png'")

# Отображение изображения
image.show()

12.8 Работа с растровой графикой
from PIL import Image, ImageFilter, ImageEnhance
import os

def process_image(input_path, output_path, format='JPEG', quality=85):
    """Обработка изображения с изменением формата и качества"""
    try:
        # Открытие изображения
        with Image.open(input_path) as img:
            print(f"Исходное изображение: {img.size}, {img.mode}, {img.format}")
            
            # Применение фильтров
            # Размытие
            blurred = img.filter(ImageFilter.BLUR)
            
            # Увеличение контраста
            enhancer = ImageEnhance.Contrast(img)
            contrasted = enhancer.enhance(1.5)
            
            # Увеличение яркости
            brightness_enhancer = ImageEnhance.Brightness(img)
            brightened = brightness_enhancer.enhance(1.2)
            
            # Сохранение в разных форматах
            if format.upper() == 'JPEG':
                img.save(output_path, 'JPEG', quality=quality)
            elif format.upper() == 'PNG':
                img.save(output_path, 'PNG')
            elif format.upper() == 'BMP':
                img.save(output_path, 'BMP')
            else:
                img.save(output_path)
            
            # Получение информации о файле
            file_size = os.path.getsize(output_path)
            print(f"Обработанное изображение сохранено: {output_path}")
            print(f"Размер файла: {file_size} байт")
            print(f"Формат: {format}, Качество: {quality}")
            
            return True
    except Exception as e:
        print(f"Ошибка при обработке изображения: {e}")
        return False

# Пример использования
# process_image('input.jpg', 'output.jpg', 'JPEG', 85)

12.9 Создание интерактивных графиков
import matplotlib.pyplot as plt
import numpy as np
from matplotlib.widgets import Button, Slider

def create_interactive_plot():
    # Создание данных
    x = np.linspace(0, 2*np.pi, 1000)
    
    # Создание фигуры и осей
    fig, ax = plt.subplots(figsize=(10, 8))
    plt.subplots_adjust(bottom=0.25)
    
    # Начальные параметры
    initial_freq = 1.0
    initial_amp = 1.0
    
    # Создание графика
    line, = ax.plot(x, initial_amp * np.sin(initial_freq * x), 'b-', linewidth=2)
    ax.set_xlim(0, 2*np.pi)
    ax.set_ylim(-2, 2)
    ax.grid(True, alpha=0.3)
    ax.set_title('Интерактивный график sin(x)')
    
    # Создание слайдеров
    ax_freq = plt.axes([0.1, 0.1, 0.3, 0.03])
    ax_amp = plt.axes([0.6, 0.1, 0.3, 0.03])
    
    slider_freq = Slider(ax_freq, 'Частота', 0.1, 5.0, valinit=initial_freq)
    slider_amp = Slider(ax_amp, 'Амплитуда', 0.1, 2.0, valinit=initial_amp)
    
    def update(val):
        freq = slider_freq.val
        amp = slider_amp.val
        line.set_ydata(amp * np.sin(freq * x))
        fig.canvas.draw_idle()
    
    slider_freq.on_changed(update)
    slider_amp.on_changed(update)
    
    plt.show()

# Запуск интерактивного графика
# create_interactive_plot()

12.10 Создание 3D графиков
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D
import numpy as np

def create_3d_plot():
    # Создание данных для 3D поверхности
    x = np.linspace(-5, 5, 100)
    y = np.linspace(-5, 5, 100)
    X, Y = np.meshgrid(x, y)
    Z = np.sin(np.sqrt(X**2 + Y**2))
    
    # Создание 3D графика
    fig = plt.figure(figsize=(12, 8))
    
    # 3D поверхность
    ax1 = fig.add_subplot(221, projection='3d')
    surf = ax1.plot_surface(X, Y, Z, cmap='viridis', alpha=0.8)
    ax1.set_title('3D Поверхность')
    ax1.set_xlabel('X')
    ax1.set_ylabel('Y')
    ax1.set_zlabel('Z')
    
    # 3D проволочная сетка
    ax2 = fig.add_subplot(222, projection='3d')
    ax2.plot_wireframe(X, Y, Z, alpha=0.6)
    ax2.set_title('3D Проволочная сетка')
    ax2.set_xlabel('X')
    ax2.set_ylabel('Y')
    ax2.set_zlabel('Z')
    
    # 3D контур
    ax3 = fig.add_subplot(223, projection='3d')
    ax3.contour(X, Y, Z, levels=20)
    ax3.set_title('3D Контур')
    ax3.set_xlabel('X')
    ax3.set_ylabel('Y')
    ax3.set_zlabel('Z')
    
    # 2D контур
    ax4 = fig.add_subplot(224)
    contour = ax4.contour(X, Y, Z, levels=20)
    ax4.clabel(contour, inline=True, fontsize=8)
    ax4.set_title('2D Контур')
    ax4.set_xlabel('X')
    ax4.set_ylabel('Y')
    
    plt.tight_layout()
    plt.show()

# Запуск 3D графика
# create_3d_plot()

12.11 Работа с анимацией
import matplotlib.pyplot as plt
import matplotlib.animation as animation
import numpy as np

def create_animation():
    # Создание фигуры
    fig, ax = plt.subplots(figsize=(10, 6))
    
    # Настройка осей
    ax.set_xlim(0, 2*np.pi)
    ax.set_ylim(-1.5, 1.5)
    ax.grid(True, alpha=0.3)
    ax.set_title('Анимированный график sin(x)')
    
    # Создание линии
    line, = ax.plot([], [], 'b-', linewidth=2)
    
    def animate(frame):
        x = np.linspace(0, 2*np.pi, 100)
        y = np.sin(x + frame * 0.1)
        line.set_data(x, y)
        return line,
    
    # Создание анимации
    anim = animation.FuncAnimation(fig, animate, frames=200, interval=50, blit=True)
    
    plt.show()
    return anim

# Запуск анимации
# anim = create_animation()

12.12 Создание GUI приложения с графикой
import tkinter as tk
from tkinter import ttk, messagebox
import matplotlib.pyplot as plt
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
import numpy as np

class GraphicsApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Приложение для работы с графикой")
        self.root.geometry("800x600")
        
        self.create_widgets()
        self.create_plot()
    
    def create_widgets(self):
        # Панель управления
        control_frame = ttk.Frame(self.root)
        control_frame.pack(side=tk.TOP, fill=tk.X, padx=5, pady=5)
        
        ttk.Button(control_frame, text="sin(x)", command=self.plot_sin).pack(side=tk.LEFT, padx=5)
        ttk.Button(control_frame, text="cos(x)", command=self.plot_cos).pack(side=tk.LEFT, padx=5)
        ttk.Button(control_frame, text="sin(x)*cos(x)", command=self.plot_sin_cos).pack(side=tk.LEFT, padx=5)
        ttk.Button(control_frame, text="Очистить", command=self.clear_plot).pack(side=tk.LEFT, padx=5)
        
        # Слайдер для частоты
        ttk.Label(control_frame, text="Частота:").pack(side=tk.LEFT, padx=(20, 5))
        self.freq_var = tk.DoubleVar(value=1.0)
        self.freq_scale = ttk.Scale(control_frame, from_=0.1, to=5.0, variable=self.freq_var, orient=tk.HORIZONTAL)
        self.freq_scale.pack(side=tk.LEFT, padx=5)
        
        # Слайдер для амплитуды
        ttk.Label(control_frame, text="Амплитуда:").pack(side=tk.LEFT, padx=(20, 5))
        self.amp_var = tk.DoubleVar(value=1.0)
        self.amp_scale = ttk.Scale(control_frame, from_=0.1, to=3.0, variable=self.amp_var, orient=tk.HORIZONTAL)
        self.amp_scale.pack(side=tk.LEFT, padx=5)
    
    def create_plot(self):
        # Создание matplotlib фигуры
        self.fig, self.ax = plt.subplots(figsize=(8, 4))
        self.ax.set_xlim(0, 2*np.pi)
        self.ax.set_ylim(-3, 3)
        self.ax.grid(True, alpha=0.3)
        self.ax.set_title('График функции')
        self.ax.set_xlabel('x')
        self.ax.set_ylabel('y')
        
        # Встраивание в tkinter
        self.canvas = FigureCanvasTkAgg(self.fig, self.root)
        self.canvas.get_tk_widget().pack(side=tk.TOP, fill=tk.BOTH, expand=True)
    
    def plot_function(self, func, label, color):
        x = np.linspace(0, 2*np.pi, 1000)
        freq = self.freq_var.get()
        amp = self.amp_var.get()
        y = amp * func(freq * x)
        
        self.ax.plot(x, y, color=color, linewidth=2, label=f"{label} (freq={freq:.1f}, amp={amp:.1f})")
        self.ax.legend()
        self.canvas.draw()
    
    def plot_sin(self):
        self.plot_function(np.sin, "sin(x)", "blue")
    
    def plot_cos(self):
        self.plot_function(np.cos, "cos(x)", "red")
    
    def plot_sin_cos(self):
        self.plot_function(lambda x: np.sin(x) * np.cos(x), "sin(x)*cos(x)", "green")
    
    def clear_plot(self):
        self.ax.clear()
        self.ax.set_xlim(0, 2*np.pi)
        self.ax.set_ylim(-3, 3)
        self.ax.grid(True, alpha=0.3)
        self.ax.set_title('График функции')
        self.ax.set_xlabel('x')
        self.ax.set_ylabel('y')
        self.canvas.draw()

def main():
    root = tk.Tk()
    app = GraphicsApp(root)
    root.mainloop()

if __name__ == "__main__":
    main()

12.13 Форматы растровой графики
Python поддерживает множество форматов изображений:

- **BMP** - без сжатия, высокое качество, большой размер
- **JPEG** - сжатие с потерями, хорош для фотографий
- **PNG** - сжатие без потерь, поддерживает прозрачность
- **GIF** - анимация, ограниченная палитра цветов
- **TIFF** - профессиональный формат, поддерживает слои
- **WebP** - современный формат с хорошим сжатием

Пример работы с разными форматами:
from PIL import Image
import os

def convert_image_format(input_path, output_path, format='JPEG', quality=85):
    """Конвертация изображения в другой формат"""
    try:
        with Image.open(input_path) as img:
            # Конвертация в RGB если необходимо
            if format.upper() in ['JPEG', 'JPG'] and img.mode in ['RGBA', 'LA']:
                background = Image.new('RGB', img.size, (255, 255, 255))
                background.paste(img, mask=img.split()[-1] if img.mode == 'RGBA' else None)
                img = background
            
            # Сохранение в новом формате
            if format.upper() in ['JPEG', 'JPG']:
                img.save(output_path, format.upper(), quality=quality, optimize=True)
            else:
                img.save(output_path, format.upper())
            
            # Информация о файлах
            input_size = os.path.getsize(input_path)
            output_size = os.path.getsize(output_path)
            compression_ratio = input_size / output_size if output_size > 0 else 0
            
            print(f"Конвертация завершена:")
            print(f"Исходный файл: {input_size} байт")
            print(f"Результирующий файл: {output_size} байт")
            print(f"Коэффициент сжатия: {compression_ratio:.2f}")
            
            return True
    except Exception as e:
        print(f"Ошибка конвертации: {e}")
        return False

Краткие итоги. В лекции были изучены основы работы с графикой в Python. Ознакомились с библиотеками matplotlib, PIL/Pillow для создания графиков и обработки изображений. Рассмотрены способы создания графических примитивов, работы с текстом, создания анимаций и интерактивных графиков.

Контрольные вопросы
Какие библиотеки используются для работы с графикой в Python?
Как создать простой график функции с помощью matplotlib?
Для чего используется библиотека PIL/Pillow?
Как нарисовать графические примитивы (линии, прямоугольники, круги)?
Как работать с текстом и шрифтами в графике?
Расскажите о создании 3D графиков.
Как создать анимированный график?
Какие форматы изображений поддерживает Python?
Как создать GUI приложение с графикой?
Приведите пример работы с растровой графикой.
Как конвертировать изображения между разными форматами?
Что такое интерактивные графики и как их создать?
